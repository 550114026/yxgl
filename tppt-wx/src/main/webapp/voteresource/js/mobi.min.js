if (typeof Mobi == "undefined") {
    Mobi = {}
}
(function(b, a, d) {
    a.initFooter = function() {
        var m = b("#webFooterBox");
        var k = 200039;
        var f = {
            CLICK_FREE: 3,
            CLICK_PAY: 4,
            EXPOSURE_FREE: 5,
            EXPOSURE_PAY: 6
        };
        j(m);
        l(m);
        function j(p) {
            var o = p.find(".J_supportLink");
            var q = "touchend.logClick";
            var r = false;
            if (!r) {
                q = "click.logClick"
            }
            o.off(q).on(q, n);
            function n(s) {
                if (e()) {
                    a.logDog(k, f.CLICK_PAY)
                }
                if (h()) {
                    a.logDog(k, f.CLICK_FREE)
                }
            }
        }
        function l(r) {
            var q = r.find(".J_supportLink");
            if (q.length === 0) {
                return
            }
            var u = b(window);
            var p = "scroll.footerSupportLinkExposure";
            var t = "resize.footerSupportLinkExposure";
            var s = a.throttle(o);
            u.off(p).on(p, s);
            u.off(t).on(t, s);
            o();
            function o() {
                var v = a.isInViewArea(u, q);
                if (v) {
                    if (e()) {
                        a.logDog(k, f.EXPOSURE_PAY)
                    }
                    if (h()) {
                        a.logDog(k, f.EXPOSURE_FREE)
                    }
                    n()
                }
            }
            function n() {
                u.off(p).off(t)
            }
        }
        function e() {
            var o = (Fai.top._oem !== true);
            var n = !h();
            return o && n
        }
        function h() {
            var n = (Fai.top._oem !== true);
            return n && Fai.top._isFreeVer === true
        }
    };
    a.throttle = function(e, f) {
        e._throttleTime = f || 300;
        return function() {
            clearTimeout(e._throttleTimer);
            e._throttleTimer = setTimeout(function() {
                    e.apply(this, arguments)
                },
                e._throttleTime)
        }
    };
    a.isInViewArea = function(n, h) {
        if (h.length === 0) {
            return false
        }
        var v = h[0];
        var k = b("#fixedAreaBox").offset().height;
        var f = v.getBoundingClientRect();
        var p = f.top;
        var l = f.bottom - f.height / 2;
        var j = f.left;
        var w = f.right;
        var m = b("#g_web");
        var o = m.offset();
        var u = o.width;
        var e = b("body").offset().height - k;
        var q = o.left;
        var x = q + u;
        var r = (j >= q && w <= x);
        var t = (p >= 0 && l < e);
        var s = false;
        if (r && t) {
            s = true
        }
        return s
    };
    function c(j) {
        var p = b(j);
        var k = p.offset();
        var o = p.css("padding-top");
        var f = p.css("padding-bottom");
        var e = p.css("margin-top");
        var h = p.css("margin-bottom");
        var n = k.height;
        var l = [o, f, e, h, n];
        var m = 0;
        l.forEach(function(q) {
            q = parseInt(q) || 0;
            m += q
        });
        return m
    }
} (jm, Mobi));

Mobi.initSwipe = function(a, o, h) {
    var t = Mobi.getJQMobi();
    var w = f(a);
    var m = jm("#webBanner")[0];
    if (!w) {
        return
    }
    if (jm._swipehandle) {
        jm._swipehandle.kill()
    }
    var d = w.querySelectorAll(".bannerImageDiv.customBanner"),
        y = w.querySelectorAll(".bannerImageDiv"),
        z = d.length,
        j = y.length,
        l = w.offsetWidth,
        c = "",
        p = 0,
        r,
        A,
        B;
    for (var x = 0; x < z; x++) {
        r = parseInt(d[x].getAttribute("vwidth"));
        A = parseInt(d[x].getAttribute("vheight"));
        B = A / r;
        if (B > p) {
            p = B
        }
    }
    if (j === 0) {
        var s = Mobi.preciseDecimal(l * 300 / 640, 2);
        w.querySelector(".defaultBanner").style.height = s + "px"
    } else {
        c = u();
        w.style.height = c + "px";
        m.style.height = c + "px"
    }
    if (!h) {
        if (!Mobi.checkBrowser() || o.et == 1) {
            jm._swipehandle = t("#" + a).swipehandle(w, {
                auto: 3000,
                continuous: true,
                bulletsClick: true,
                speed: o.st * 100,
                callback: function(D) {
                    var C = e.length;
                    while (C--) {
                        e[C].className = " "
                    }
                    if (!e[D]) {
                        e[D - e.length].className = "on"
                    } else {
                        e[D].className = "on"
                    }
                }
            })
        } else {
            w.style.visibility = "visible";
            var k = w.getBoundingClientRect().width,
                b = w.children[0],
                v = b.children;
            var n = v.length;
            while (n--) {
                v[n].style.width = k + "px"
            }
        }
        if (!w.querySelector(".bullets")) {
            return
        }
        var e = w.querySelector(".bullets").getElementsByTagName("li");
        return
    }
    function f(E) {
        var C = Mobi.getPreviewObject(E);
        if (C !== null) {
            var D = q(C);
            if (!D) {
                C = document.querySelector("#" + E)
            }
        }
        return C
    }
    function q(D) {
        var E = D.baseURI;
        var C = location.host;
        return E.indexOf(C) > -1
    }
    function u() {
        var C = 0;
        var D = (j - z > 0);
        if (D) {
            C = (l * p < l * 300 / 640 ? Mobi.preciseDecimal(l * 300 / 640, 2) : Mobi.preciseDecimal(l * p, 2))
        } else {
            C = Mobi.preciseDecimal(l * p, 2)
        }
        return C
    }
};


Mobi.preciseDecimal = function(d, f) {
    if (isNaN(parseFloat(d)) && !isFinite(d) || !!f || (typeof f == "number" && f <= 0)) {
        return d
    }
    var e = d + "",
        c = e.indexOf("."),
        b,
        a;
    if (c < 0) {
        return d
    }
    b = parseInt(e.slice(0, c));
    a = parseFloat(e.slice(c, e.length));
    return (b + parseFloat(a.toPrecision(f)))
};
Mobi.getJQMobi = function() {
    var b = Mobi.getPreviewWindow(),
        a = b.jm;
    return a
};
Mobi.getPreviewWindow = function() {
    var b = Fai.top.document.getElementById("mobiReviewPageFrame");
    var a = !b ? window: b.contentWindow;
    return a
};

Mobi.getPreviewDocument = function() {
    var a = Mobi.getPreviewWindow().document;
    return a
};
Mobi.getPreviewObject = function(a) {
    if (!a) {
        return
    }
    return Mobi.getPreviewDocument().getElementById(a)
};

Mobi.checkBrowser = (function() {
    var c = ["animation", "MozAnimation", "webkitAnimation", "msAnimation", "OAnimation"],
        e = ["transform", "MozTransform", "webkitTransform", "msTransform", "OTransform"],
        b = ["opacity", "MozOpacity", "webkitOpacity", "msOpacity", "OOpacity"],
        d = document.createElement("div"),
        a = {};
    return function(h) {
        if (typeof a[h] == "boolean") {
            return a[h]
        }
        switch (h) {
            case "animation":
                props = c;
                break;
            case "transform":
                props = e;
                break;
            case "opacity":
                props = b;
                break;
            default:
                props = c
        }
        for (var j = 0,
                 f = props.length; j < f; j++) {
            if (d.style[props[j]] !== undefined) {
                a[h] = true;
                return a[h]
            }
        }
        a[h] = false;
        return a[h]
    }
})();


Mobi.autoFixGWebTop = function(f) {
    if (Fai.top._templateFrameId >= 2000 && Fai.top._templateFrameId < 3000) {
        jm("#fk-gWebPlaceholdPT").remove();
        return
    }
    var l = Mobi.webTop(),
        h = Mobi.getPreviewObject("g_web"),
        //k = Mobi.getPreviewObject("webTop"),
        j = Mobi.getPreviewObject("webBodyBackground"),
        e = Mobi.getPreviewObject("webHeaderBox");
    e.style.top = "";
    //k.style.top = "";
    if (f !== 2 && f !== 7 && f !== 8) {
        var d = Mobi.getPreviewObject("fk-gWebPlaceholdPT");
        if (d) {
            d.style.height = l + "px"
        } else {
            d = jm("<div id='fk-gWebPlaceholdPT' style='height:" + l + "px;'></div>");
            jm(h).prepend(d)
        }
        return
    }
    if (f == 7) {
        var c = jm("#webHeader"),
            b = Mobi.getPreviewObject("navbar");
        if (l > 0) {
            b.style.top = l + "px"
        }
        if (c.css("display") === "none") {
            return
        }
    }
    e.style.top = l + "px";
    //k.style.top = l + "px";
    var d = Mobi.getPreviewObject("fk-gWebPlaceholdPT");
    var a = Mobi.getPreviewObject("webHeader");
    if (d) {
        d.style.height = (a.offsetHeight + l) + "px"
    } else {
        d = jm("<div id='fk-gWebPlaceholdPT' style='height:" + (a.offsetHeight + l) + "px;'></div>");
        jm(h).prepend(d)
    }
};


Mobi.webTop = function() {
    var b = 0,
        a = Mobi.getPreviewObject("mobiTipsMarquee");
    if (!a) {
        return b
    } else {
        var c = Mobi.getPreviewObject("webTips").offsetHeight;
        b = c;
        return b
    }
};

Mobi.initFooterHeight = function() {
    var b = Mobi.getPreviewObject("webFooter");
    b.style.height = "";
    jm("#webModuleContainer").css({
        overflow: "hidden"
    });
    var e = 0,
        a = b.clientHeight,
        c = document.documentElement.clientHeight,
        f = jm("#g_web>div");
    for (var d = 0; d < f.length; d++) {
        e += f[d].clientHeight
    }
    if (e <= c) {
        b.style.display="none"
        //b.style.height = (c - e) + a + "px"
    } else {
        b.style.height = ""
    }
};

Mobi.initBgmCookie = function() {
    jm.cookie("_bgmIsPause", null)
};

Mobi.ing = function(q, r, n) {
    var e = (q == null || q == "") ? "正在处理...": q;
    var p = "";
    var f = false;
    if (r == "" || r == null || r == 0) {
        p = "<div class='icon-errorTigs'></div>"
    } else {
        if (r == 1) {
            p = "<div class='icon-succeedTigs'></div>"
        } else {
            if (r == -1) {
                p = ""
            }
        }
    }
    n = n ? n: false;
    var d = Fai.top.document.body.clientWidth;
    var a = Fai.top.document.body.clientHeight;
    var l = jm("body").attr("class");
    var k = "";
    if (l.indexOf("2052") >= 0) {
        k = parseFloat(q.length);
        if (k > 13 && k < 39) {
            k = 15;
            e = q.substring(0, 13) + "<br>" + q.substring(13)
        } else {
            if (k > 39) {
                k = 15;
                e = q.substring(0, 13) + "<br>" + q.substring(13, 39) + "<br>" + q.substring(39)
            }
        }
    } else {
        k = parseFloat(q.length) / 2;
        if (k > 15) {
            var j = q.substring(0, 30).lastIndexOf(" ");
            if (q.charAt(30) != "" && k < 50) {
                if (j < 15) {
                    j = 30
                }
                e = q.substring(0, j) + "<br>" + q.substring(j)
            } else {
                if (k > 50) {
                    var h = q.substring(30, 50).lastIndexOf(" ");
                    e = q.substring(0, j) + "<br>" + q.substring(j, h) + "<br>" + q.substring(h)
                }
            }
            k = 15
        }
    }
    k += "rem";
    var m = "";
    m = "<div id='mobiIngTigs' class='mobiIngTigs'></div>";
    if (jm("#mobiIngTigs").length == 0) {
        jm(m).appendTo("body")
    } else {
        f = true
    }
    var b = jm("#mobiIngTigs");
    var c = parseInt(Math.random() * 10000);
    var o = '<div id="' + c + '" class="mobiTips" style=\'width:' + k + "; '><div id=\"mobiMsg" + c + '" class="mobiMsg">' + p + "<div class=''>" + e + "</div></div></div>";
    b.html(o);
    if (f) {
        b.css("visibility", "inherit");
        b.css("opacity", "1")
    }
    if (!n) {
        window.setTimeout(function() {
                b.css("visibility", "hidden");
                b.css("opacity", "0")
            },
            1500);
        window.setTimeout(function() {
                jm("#" + c).remove();
                b.remove()
            },
            2500)
    }
};

Mobi.scrollToTop = function(b) {
    var c = document.getElementById("g_body"),
        e = c.scrollTop,
        d = 1500;
    var a = document.createElement("div");
    a.setAttribute("id", "scrollHideDiv");
    a.style.cssText = "position:absolute;width:100%;height:100%;top:0;z-index:9999;";
    if (jm("#navbar").hasClass("scroll_fix")) {
        jm("#navbar").removeClass("scroll_fix")
    }
    c.style.marginTop = -e + "px";
    window.scrollTo(0, 0);
    c.appendChild(a);
    c.style[jm.feat.cssPrefix + "Transition"] = "margin-top " + d + "ms cubic-bezier(0.175, 0.885, 0.320, 1.025)";
    c.style.marginTop = 0 + "px";
    setTimeout(function() {
            c.style[jm.feat.cssPrefix + "Transition"] = "none";
            var f = document.getElementById("scrollHideDiv");
            c.removeChild(f)
        },
        d);
    Mobi.scrollBgmPosition()
};

Mobi.scrollBgmPosition = function() {
    var a = jm("#bgMusic .bgm_icon"),
        h = jm("#webMultilingualArea"),
        j = jm("#webHeaderBox"),
        b = jm(".loginHeader.webHeaderBg"),
        e = parseInt(j.height()),
        d = jm("body"),
        k = Fai.top._templateFrameId;
    var l = 0,
        f = 10,
        c = document.documentElement.scrollTop || document.body.scrollTop;
    if (a.hasClass("bgm_rightUp") || a.hasClass("bgm_leftUp")) {
        if (h.length > 0) {
            l = h.offset().top + parseInt(h.height()) - c
        } else {
            l = j.offset().top + e - c
        }
        if (!l) {
            if (d.hasClass("mobiCol20") || d.hasClass("mobiCol21") || d.hasClass("mobiCol24") || d.hasClass("mobiCol28")) {
                if (k >= 2000) {
                    l = e + 10
                } else {
                    if (jm(".productDetailHeader").height() > 0) {
                        l = parseInt(jm(".productDetailHeader").height()) + 10
                    } else {
                        if (jm(".photoGroupDetailHeader").height() > 0) {
                            l = parseInt(jm(".photoGroupDetailHeader").height()) + 10
                        }
                    }
                }
            } else {
                if (b.length > 0) {
                    l = b.offset().top + parseInt(b.height()) - c + 10
                }
                l = l > 0 ? l: 10;
                if (k === 2004) {
                    l = l + e
                }
            }
            a.css("top", l + "px");
            return
        }
        if (j.css("position") == "fixed") {
            if (l >= e) {
                f = l + 10
            } else {
                f = e + 10
            }
        } else {
            if (l >= 0) {
                f = l + 10
            }
        }
        a.css("top", f + "px")
    }
};